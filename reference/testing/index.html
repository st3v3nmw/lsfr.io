<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content='Testing Framework# The lsfr testing framework (attest) provides a fluent API for writing black-box tests against programs. Tests validate external behavior without accessing implementation internals.
Quick Start# A typical test suite:
package kvstore import ( . "github.com/st3v3nmw/lsfr/internal/attest" ) func HTTPAPI() *Suite { return New(). // 0 Setup(func(do *Do) { do.Start("node") }). // 1 Test("PUT stores data", func(do *Do) { do.HTTP("node", "PUT", "/kv/key", "value").T(). Status(Is(200)). Assert("Your server should accept PUT requests.\n" + "Ensure your HTTP handler processes PUT to /kv/{key}.") }). // 2 Test("GET retrieves data", func(do *Do) { do.HTTP("node", "GET", "/kv/key").T(). Status(Is(200)). Body(Is("value")). Assert("Your server should return stored values.") }) }Tests run sequentially. State persists between tests so data written in test 1 is available in test 2. First failure stops execution.
'><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://lsfr.io/reference/testing/"><meta property="og:site_name" content="lsfr.io"><meta property="og:title" content="Testing"><meta property="og:description" content='Testing Framework# The lsfr testing framework (attest) provides a fluent API for writing black-box tests against programs. Tests validate external behavior without accessing implementation internals.
Quick Start# A typical test suite:
package kvstore import ( . "github.com/st3v3nmw/lsfr/internal/attest" ) func HTTPAPI() *Suite { return New(). // 0 Setup(func(do *Do) { do.Start("node") }). // 1 Test("PUT stores data", func(do *Do) { do.HTTP("node", "PUT", "/kv/key", "value").T(). Status(Is(200)). Assert("Your server should accept PUT requests.\n" + "Ensure your HTTP handler processes PUT to /kv/{key}.") }). // 2 Test("GET retrieves data", func(do *Do) { do.HTTP("node", "GET", "/kv/key").T(). Status(Is(200)). Body(Is("value")). Assert("Your server should return stored values.") }) }Tests run sequentially. State persists between tests so data written in test 1 is available in test 2. First failure stops execution.'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="reference"><meta property="article:modified_time" content="2025-12-30T13:48:14+03:00"><meta itemprop=name content="Testing"><meta itemprop=description content='Testing Framework# The lsfr testing framework (attest) provides a fluent API for writing black-box tests against programs. Tests validate external behavior without accessing implementation internals.
Quick Start# A typical test suite:
package kvstore import ( . "github.com/st3v3nmw/lsfr/internal/attest" ) func HTTPAPI() *Suite { return New(). // 0 Setup(func(do *Do) { do.Start("node") }). // 1 Test("PUT stores data", func(do *Do) { do.HTTP("node", "PUT", "/kv/key", "value").T(). Status(Is(200)). Assert("Your server should accept PUT requests.\n" + "Ensure your HTTP handler processes PUT to /kv/{key}.") }). // 2 Test("GET retrieves data", func(do *Do) { do.HTTP("node", "GET", "/kv/key").T(). Status(Is(200)). Body(Is("value")). Assert("Your server should return stored values.") }) }Tests run sequentially. State persists between tests so data written in test 1 is available in test 2. First failure stops execution.'><meta itemprop=dateModified content="2025-12-30T13:48:14+03:00"><meta itemprop=wordCount content="989"><title>Testing | lsfr.io</title><link rel=icon href=/fa-feather.svg><link rel=manifest href=/manifest.json><link rel=canonical href=https://lsfr.io/reference/testing/><link rel=stylesheet href=/book.min.ab49e21559bbdf668d64e765afb333baceaf7efe3f272a8318e6d68e610a0d3f.css integrity="sha256-q0niFVm732aNZOdlr7Mzus6vfv4/JyqDGObWjmEKDT8=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.930d811efbf51144462cb0b83aad6fdc264c05ee40f7641d0f90e5d4e1e9c2dd.js integrity="sha256-kw2BHvv1EURGLLC4Oq1v3CZMBe5A92QdD5Dl1OHpwt0=" crossorigin=anonymous></script></head><body dir=ltr class="book-kind-page book-type-reference"><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><img src=/fa-feather.svg alt=Logo class=book-icon><i>lsfr.io</i></a></h2><div class="book-search hidden"><input id=book-search-input type=text placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/how-lsfr-works/>How lsfr Works</a></li><li><input type=checkbox id=section-9c02cfb52851d47ab5511a2e6400e2c6 class=toggle>
<label for=section-9c02cfb52851d47ab5511a2e6400e2c6 class=flex><a href=/kv-store/>Distributed Key-Value Store</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/kv-store/http-api/>HTTP API</a></li><li><a href=/kv-store/persistence/>Persistence</a></li><li><a href=/kv-store/crash-recovery/>Crash Recovery</a></li><li><a href=/kv-store/leader-election/>Leader Election</a></li><li><a href=/kv-store/log-replication/>Log Replication</a></li><li><a href=/kv-store/membership-changes/>Membership Changes</a></li><li><a href=/kv-store/fault-tolerance/>Fault Tolerance</a></li><li><a href=/kv-store/log-compaction/>Log Compaction</a></li></ul></li><li><a>Guides</a><ul><li><a href=/guides/cli/>CLI</a></li><li><a href=/guides/ci-cd/>CI/CD</a></li></ul></li><li><input type=checkbox id=section-f726ddd70f9df03e77714ffcd941e3f8 class=toggle checked>
<label for=section-f726ddd70f9df03e77714ffcd941e3f8 class=flex><a role=button>Reference</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/reference/testing/ class=active>Testing</a></li><li><a href=/reference/writing-style/>Writing Style</a></li></ul></li><li><a href=/about/>About</a></li></ul><ul><li><a href=https://github.com/st3v3nmw/lsfr target=_blank rel=noopener>GitHub</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class="book-header hidden"><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3><i><a href=/ style=color:inherit;text-decoration:none>lsfr.io</a></i></h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class=hidden><nav id=TableOfContents><ul><li><a href=#quick-start>Quick Start</a></li><li><a href=#http-assertions>HTTP Assertions</a></li><li><a href=#cli-assertions>CLI Assertions</a></li><li><a href=#checkers>Checkers</a><ul><li><a href=#isvalue><code>Is(value)</code></a></li><li><a href=#isnullt><code>IsNull[T]()</code></a></li><li><a href=#containssubstring><code>Contains(substring)</code></a></li><li><a href=#matchespattern><code>Matches(pattern)</code></a></li><li><a href=#oneofvalues><code>OneOf(values...)</code></a></li><li><a href=#notchecker><code>Not(checker)</code></a></li><li><a href=#multiple-checkers>Multiple Checkers</a></li></ul></li><li><a href=#timing>Timing</a><ul><li><a href=#eventually><code>Eventually()</code></a></li><li><a href=#consistently><code>Consistently()</code></a></li><li><a href=#default-immediate>Default (Immediate)</a></li></ul></li><li><a href=#service-management>Service Management</a><ul><li><a href=#startname-args><code>Start(name, args...)</code></a></li><li><a href=#stopname><code>Stop(name)</code></a></li><li><a href=#killname><code>Kill(name)</code></a></li><li><a href=#restartname-sig><code>Restart(name, sig...)</code></a></li></ul></li><li><a href=#concurrency>Concurrency</a><ul><li><a href=#concurrentlyfuncs><code>Concurrently(funcs...)</code></a></li></ul></li><li><a href=#writing-good-assertions>Writing Good Assertions</a></li><li><a href=#creating-a-challenge>Creating a Challenge</a><ul><li><a href=#directory-structure>Directory Structure</a></li><li><a href=#stage-structure>Stage Structure</a></li><li><a href=#challenge-registration>Challenge Registration</a></li><li><a href=#auto-discovery>Auto-Discovery</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=testing-framework>Testing Framework<a class=anchor href=#testing-framework>#</a></h1><p>The lsfr testing framework (<code>attest</code>) provides a fluent API for writing black-box tests against programs. Tests validate external behavior without accessing implementation internals.</p><h2 id=quick-start>Quick Start<a class=anchor href=#quick-start>#</a></h2><p>A typical test suite:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>kvstore</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    . <span style=color:#e6db74>&#34;github.com/st3v3nmw/lsfr/internal/attest&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>HTTPAPI</span>() <span style=color:#f92672>*</span><span style=color:#a6e22e>Suite</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>New</span>().
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 0</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Setup</span>(<span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>do</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Do</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>Start</span>(<span style=color:#e6db74>&#34;node&#34;</span>)
</span></span><span style=display:flex><span>        }).
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 1</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Test</span>(<span style=color:#e6db74>&#34;PUT stores data&#34;</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>do</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Do</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>HTTP</span>(<span style=color:#e6db74>&#34;node&#34;</span>, <span style=color:#e6db74>&#34;PUT&#34;</span>, <span style=color:#e6db74>&#34;/kv/key&#34;</span>, <span style=color:#e6db74>&#34;value&#34;</span>).<span style=color:#a6e22e>T</span>().
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Status</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#ae81ff>200</span>)).
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Assert</span>(<span style=color:#e6db74>&#34;Your server should accept PUT requests.\n&#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;Ensure your HTTP handler processes PUT to /kv/{key}.&#34;</span>)
</span></span><span style=display:flex><span>        }).
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 2</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Test</span>(<span style=color:#e6db74>&#34;GET retrieves data&#34;</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>do</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Do</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>HTTP</span>(<span style=color:#e6db74>&#34;node&#34;</span>, <span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#e6db74>&#34;/kv/key&#34;</span>).<span style=color:#a6e22e>T</span>().
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Status</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#ae81ff>200</span>)).
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Body</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#e6db74>&#34;value&#34;</span>)).
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Assert</span>(<span style=color:#e6db74>&#34;Your server should return stored values.&#34;</span>)
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>Tests run sequentially. State persists between tests so data written in test 1 is available in test 2. First failure stops execution.</p><h2 id=http-assertions>HTTP Assertions<a class=anchor href=#http-assertions>#</a></h2><p>Make HTTP requests and validate responses:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// Basic request</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>HTTP</span>(<span style=color:#e6db74>&#34;node&#34;</span>, <span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#e6db74>&#34;/kv/key&#34;</span>).<span style=color:#a6e22e>T</span>().
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Status</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#ae81ff>200</span>)).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Body</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#e6db74>&#34;value&#34;</span>)).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Assert</span>(<span style=color:#e6db74>&#34;Your server should return stored values.&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// With body</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>HTTP</span>(<span style=color:#e6db74>&#34;node&#34;</span>, <span style=color:#e6db74>&#34;PUT&#34;</span>, <span style=color:#e6db74>&#34;/kv/key&#34;</span>, <span style=color:#e6db74>&#34;value&#34;</span>).<span style=color:#a6e22e>T</span>().
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Status</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#ae81ff>200</span>)).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Assert</span>(<span style=color:#e6db74>&#34;Your server should accept PUT requests.&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// With custom headers</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>HTTP</span>(<span style=color:#e6db74>&#34;node&#34;</span>, <span style=color:#e6db74>&#34;POST&#34;</span>, <span style=color:#e6db74>&#34;/api&#34;</span>, <span style=color:#e6db74>`{&#34;key&#34;:&#34;value&#34;}`</span>, <span style=color:#a6e22e>H</span>{<span style=color:#e6db74>&#34;Content-Type&#34;</span>: <span style=color:#e6db74>&#34;application/json&#34;</span>}).<span style=color:#a6e22e>T</span>().
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Status</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#ae81ff>201</span>)).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Assert</span>(<span style=color:#f92672>...</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Status only</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>HTTP</span>(<span style=color:#e6db74>&#34;node&#34;</span>, <span style=color:#e6db74>&#34;DELETE&#34;</span>, <span style=color:#e6db74>&#34;/kv/key&#34;</span>).<span style=color:#a6e22e>T</span>().
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Status</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#ae81ff>200</span>)).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Assert</span>(<span style=color:#e6db74>&#34;Your server should accept DELETE requests.&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// JSON fields</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>HTTP</span>(<span style=color:#e6db74>&#34;node&#34;</span>, <span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#e6db74>&#34;/cluster/info&#34;</span>).<span style=color:#a6e22e>T</span>().
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Status</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#ae81ff>200</span>)).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>JSON</span>(<span style=color:#e6db74>&#34;role&#34;</span>, <span style=color:#a6e22e>Is</span>(<span style=color:#e6db74>&#34;follower&#34;</span>)).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>JSON</span>(<span style=color:#e6db74>&#34;term&#34;</span>, <span style=color:#a6e22e>Is</span>(<span style=color:#e6db74>&#34;1&#34;</span>)).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Assert</span>(<span style=color:#e6db74>&#34;Should return cluster info&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>HTTP</span>(<span style=color:#e6db74>&#34;node&#34;</span>, <span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#e6db74>&#34;/log&#34;</span>).<span style=color:#a6e22e>T</span>().
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Status</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#ae81ff>200</span>)).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>JSON</span>(<span style=color:#e6db74>&#34;entries.0.term&#34;</span>, <span style=color:#a6e22e>Is</span>(<span style=color:#e6db74>&#34;1&#34;</span>)).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>JSON</span>(<span style=color:#e6db74>&#34;entries.1.index&#34;</span>, <span style=color:#a6e22e>Is</span>(<span style=color:#e6db74>&#34;1&#34;</span>)).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Assert</span>(<span style=color:#e6db74>&#34;Should return log entries&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>HTTP</span>(<span style=color:#e6db74>&#34;node&#34;</span>, <span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#e6db74>&#34;/cluster/info&#34;</span>).<span style=color:#a6e22e>T</span>().
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Status</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#ae81ff>200</span>)).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>JSON</span>(<span style=color:#e6db74>&#34;leader&#34;</span>, <span style=color:#a6e22e>IsNull</span>[<span style=color:#66d9ef>string</span>]()).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Assert</span>(<span style=color:#e6db74>&#34;Leader should be null when no leader elected&#34;</span>)</span></span></code></pre></div><h2 id=cli-assertions>CLI Assertions<a class=anchor href=#cli-assertions>#</a></h2><p>Execute CLI commands and validate output:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// Check exit code and output</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>Exec</span>(<span style=color:#e6db74>&#34;--help&#34;</span>).<span style=color:#a6e22e>T</span>().
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ExitCode</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#ae81ff>0</span>)).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Output</span>(<span style=color:#a6e22e>Contains</span>(<span style=color:#e6db74>&#34;Usage:&#34;</span>)).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Assert</span>(<span style=color:#e6db74>&#34;Your command should show usage information.&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Check exit code only</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>Exec</span>(<span style=color:#e6db74>&#34;invalid&#34;</span>, <span style=color:#e6db74>&#34;args&#34;</span>).<span style=color:#a6e22e>T</span>().
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ExitCode</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#ae81ff>1</span>)).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Assert</span>(<span style=color:#e6db74>&#34;Your command should reject invalid arguments.&#34;</span>)</span></span></code></pre></div><h2 id=checkers>Checkers<a class=anchor href=#checkers>#</a></h2><h3 id=isvalue><code>Is(value)</code><a class=anchor href=#isvalue>#</a></h3><p>Exact equality:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>.<span style=color:#a6e22e>Status</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#ae81ff>200</span>))
</span></span><span style=display:flex><span>.<span style=color:#a6e22e>Body</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#e6db74>&#34;key not found\n&#34;</span>))
</span></span><span style=display:flex><span>.<span style=color:#a6e22e>ExitCode</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#ae81ff>0</span>))</span></span></code></pre></div><h3 id=isnullt><code>IsNull[T]()</code><a class=anchor href=#isnullt>#</a></h3><p>Checks if a value is null:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// Check for null JSON field</span>
</span></span><span style=display:flex><span>.<span style=color:#a6e22e>JSON</span>(<span style=color:#e6db74>&#34;leader&#34;</span>, <span style=color:#a6e22e>IsNull</span>[<span style=color:#66d9ef>string</span>]())</span></span></code></pre></div><p>Requires a type parameter to specify the expected field type.</p><h3 id=containssubstring><code>Contains(substring)</code><a class=anchor href=#containssubstring>#</a></h3><p>String contains:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>.<span style=color:#a6e22e>Body</span>(<span style=color:#a6e22e>Contains</span>(<span style=color:#e6db74>&#34;error&#34;</span>))
</span></span><span style=display:flex><span>.<span style=color:#a6e22e>Output</span>(<span style=color:#a6e22e>Contains</span>(<span style=color:#e6db74>&#34;Usage:&#34;</span>))</span></span></code></pre></div><h3 id=matchespattern><code>Matches(pattern)</code><a class=anchor href=#matchespattern>#</a></h3><p>Regex matching:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>.<span style=color:#a6e22e>Body</span>(<span style=color:#a6e22e>Matches</span>(<span style=color:#e6db74>`^[0-9]+$`</span>))
</span></span><span style=display:flex><span>.<span style=color:#a6e22e>Output</span>(<span style=color:#a6e22e>Matches</span>(<span style=color:#e6db74>`version \d+\.\d+\.\d+`</span>))</span></span></code></pre></div><h3 id=oneofvalues><code>OneOf(values...)</code><a class=anchor href=#oneofvalues>#</a></h3><p>Match any of several values:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// Useful for concurrent operations where order is non-deterministic</span>
</span></span><span style=display:flex><span>.<span style=color:#a6e22e>Body</span>(<span style=color:#a6e22e>OneOf</span>(<span style=color:#e6db74>&#34;value1&#34;</span>, <span style=color:#e6db74>&#34;value2&#34;</span>, <span style=color:#e6db74>&#34;value3&#34;</span>))</span></span></code></pre></div><h3 id=notchecker><code>Not(checker)</code><a class=anchor href=#notchecker>#</a></h3><p>Negates another checker:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>.<span style=color:#a6e22e>Status</span>(<span style=color:#a6e22e>Not</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#ae81ff>500</span>)))
</span></span><span style=display:flex><span>.<span style=color:#a6e22e>Body</span>(<span style=color:#a6e22e>Not</span>(<span style=color:#a6e22e>Contains</span>(<span style=color:#e6db74>&#34;panic&#34;</span>)))</span></span></code></pre></div><h3 id=multiple-checkers>Multiple Checkers<a class=anchor href=#multiple-checkers>#</a></h3><p>Chain multiple checkers for the same field:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// Multiple status checks</span>
</span></span><span style=display:flex><span>.<span style=color:#a6e22e>Status</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#ae81ff>200</span>), <span style=color:#a6e22e>Not</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#ae81ff>404</span>)), <span style=color:#a6e22e>Not</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#ae81ff>500</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Multiple body checks</span>
</span></span><span style=display:flex><span>.<span style=color:#a6e22e>Body</span>(<span style=color:#a6e22e>Contains</span>(<span style=color:#e6db74>&#34;Hello&#34;</span>), <span style=color:#a6e22e>Contains</span>(<span style=color:#e6db74>&#34;World&#34;</span>), <span style=color:#a6e22e>Not</span>(<span style=color:#a6e22e>Contains</span>(<span style=color:#e6db74>&#34;Goodbye&#34;</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Multiple JSON field checks</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>JSON</span>(<span style=color:#e6db74>&#34;role&#34;</span>, <span style=color:#a6e22e>Is</span>(<span style=color:#e6db74>&#34;leader&#34;</span>), <span style=color:#a6e22e>Not</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#e6db74>&#34;follower&#34;</span>)), <span style=color:#a6e22e>Not</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#e6db74>&#34;candidate&#34;</span>)))</span></span></code></pre></div><p>All checkers for a field must pass. If any checker fails, the assertion fails.</p><h2 id=timing>Timing<a class=anchor href=#timing>#</a></h2><h3 id=eventually><code>Eventually()</code><a class=anchor href=#eventually>#</a></h3><p>Retry until condition becomes true or timeout (default 5s):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// Wait for replica to sync</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>HTTP</span>(<span style=color:#e6db74>&#34;replica&#34;</span>, <span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#e6db74>&#34;/kv/key&#34;</span>).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Eventually</span>().<span style=color:#a6e22e>T</span>().
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Status</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#ae81ff>200</span>)).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Body</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#e6db74>&#34;value&#34;</span>)).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Assert</span>(<span style=color:#e6db74>&#34;Replica should eventually receive replicated data.&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Custom timeout</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>HTTP</span>(<span style=color:#e6db74>&#34;replica&#34;</span>, <span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#e6db74>&#34;/kv/key&#34;</span>).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Eventually</span>().<span style=color:#a6e22e>Within</span>(<span style=color:#ae81ff>10</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>).<span style=color:#a6e22e>T</span>().
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Status</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#ae81ff>200</span>)).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Body</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#e6db74>&#34;value&#34;</span>)).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Assert</span>(<span style=color:#e6db74>&#34;Replica should sync within 10 seconds.&#34;</span>)</span></span></code></pre></div><h3 id=consistently><code>Consistently()</code><a class=anchor href=#consistently>#</a></h3><p>Verify condition stays true for duration (default 5s):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// Verify value remains stable</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>HTTP</span>(<span style=color:#e6db74>&#34;node&#34;</span>, <span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#e6db74>&#34;/kv/key&#34;</span>).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Consistently</span>().<span style=color:#a6e22e>T</span>().
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Status</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#ae81ff>200</span>)).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Body</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#e6db74>&#34;value&#34;</span>)).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Assert</span>(<span style=color:#e6db74>&#34;Value should remain stable.&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Custom duration</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>HTTP</span>(<span style=color:#e6db74>&#34;node&#34;</span>, <span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#e6db74>&#34;/kv/key&#34;</span>).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Consistently</span>().<span style=color:#a6e22e>For</span>(<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>).<span style=color:#a6e22e>T</span>().
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Status</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#ae81ff>200</span>)).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Body</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#e6db74>&#34;value&#34;</span>)).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Assert</span>(<span style=color:#e6db74>&#34;Value should remain stable for 2 seconds.&#34;</span>)</span></span></code></pre></div><h3 id=default-immediate>Default (Immediate)<a class=anchor href=#default-immediate>#</a></h3><p>Without <code>Eventually()</code> or <code>Consistently()</code>, checks execute once immediately:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>HTTP</span>(<span style=color:#e6db74>&#34;node&#34;</span>, <span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#e6db74>&#34;/kv/key&#34;</span>).<span style=color:#a6e22e>T</span>().
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Status</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#ae81ff>200</span>)).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Assert</span>(<span style=color:#e6db74>&#34;Your server should return the value immediately.&#34;</span>)</span></span></code></pre></div><h2 id=service-management>Service Management<a class=anchor href=#service-management>#</a></h2><h3 id=startname-args><code>Start(name, args...)</code><a class=anchor href=#startname-args>#</a></h3><p>Start a service with auto-assigned port:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>Start</span>(<span style=color:#e6db74>&#34;node&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>Start</span>(<span style=color:#e6db74>&#34;replica&#34;</span>, <span style=color:#e6db74>&#34;--seed=123&#34;</span>)</span></span></code></pre></div><p>Port is auto-assigned by the OS. Services receive <code>--port</code> and <code>--working-dir</code> flags automatically. Each test run gets an isolated working directory like <code>run-20240115-143022</code>.</p><h3 id=stopname><code>Stop(name)</code><a class=anchor href=#stopname>#</a></h3><p>Graceful shutdown with SIGTERM:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>Stop</span>(<span style=color:#e6db74>&#34;node&#34;</span>)</span></span></code></pre></div><p>Sends SIGTERM and waits for graceful exit. If process doesn&rsquo;t exit within timeout, sends SIGKILL.</p><h3 id=killname><code>Kill(name)</code><a class=anchor href=#killname>#</a></h3><p>Immediate termination with SIGKILL:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>Kill</span>(<span style=color:#e6db74>&#34;node&#34;</span>)</span></span></code></pre></div><h3 id=restartname-sig><code>Restart(name, sig...)</code><a class=anchor href=#restartname-sig>#</a></h3><p>Restart a service:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// Graceful restart (SIGTERM)</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>Restart</span>(<span style=color:#e6db74>&#34;node&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Crash simulation (SIGKILL)</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>Restart</span>(<span style=color:#e6db74>&#34;node&#34;</span>, <span style=color:#a6e22e>syscall</span>.<span style=color:#a6e22e>SIGKILL</span>)</span></span></code></pre></div><p>The optional signal parameter controls how the process is stopped before restart. SIGKILL simulates crashes with no cleanup, SIGTERM allows graceful shutdown.</p><h2 id=concurrency>Concurrency<a class=anchor href=#concurrency>#</a></h2><h3 id=concurrentlyfuncs><code>Concurrently(funcs...)</code><a class=anchor href=#concurrentlyfuncs>#</a></h3><p>Run operations in parallel:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>Concurrently</span>(
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>HTTP</span>(<span style=color:#e6db74>&#34;node&#34;</span>, <span style=color:#e6db74>&#34;PUT&#34;</span>, <span style=color:#e6db74>&#34;/kv/key1&#34;</span>, <span style=color:#e6db74>&#34;value1&#34;</span>).<span style=color:#a6e22e>T</span>().
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Status</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#ae81ff>200</span>)).
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Assert</span>(<span style=color:#f92672>...</span>)
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>HTTP</span>(<span style=color:#e6db74>&#34;node&#34;</span>, <span style=color:#e6db74>&#34;PUT&#34;</span>, <span style=color:#e6db74>&#34;/kv/key2&#34;</span>, <span style=color:#e6db74>&#34;value2&#34;</span>).<span style=color:#a6e22e>T</span>().
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Status</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#ae81ff>200</span>)).
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Assert</span>(<span style=color:#f92672>...</span>)
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Verify both succeeded</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>HTTP</span>(<span style=color:#e6db74>&#34;node&#34;</span>, <span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#e6db74>&#34;/kv/key1&#34;</span>).<span style=color:#a6e22e>T</span>().
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Status</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#ae81ff>200</span>)).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Body</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#e6db74>&#34;value1&#34;</span>)).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Assert</span>(<span style=color:#f92672>...</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>HTTP</span>(<span style=color:#e6db74>&#34;node&#34;</span>, <span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#e6db74>&#34;/kv/key2&#34;</span>).<span style=color:#a6e22e>T</span>().
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Status</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#ae81ff>200</span>)).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Body</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#e6db74>&#34;value2&#34;</span>)).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Assert</span>(<span style=color:#f92672>...</span>)</span></span></code></pre></div><p>Waits for all functions to complete. If any panic, the first panic is re-raised after all complete.</p><h2 id=writing-good-assertions>Writing Good Assertions<a class=anchor href=#writing-good-assertions>#</a></h2><p>Assertion messages appear when tests fail. They should help developers fix the problem.</p><p>Good assertion messages describe expected behavior, provide concrete next steps, and reference relevant concepts:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>Assert</span>(<span style=color:#e6db74>&#34;Your server should reject empty keys.\n&#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Add validation to return 400 Bad Request for empty keys.&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Assert</span>(<span style=color:#e6db74>&#34;Your server should preserve data across crashes.\n&#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Implement a Write-Ahead Log (WAL) that records operations before applying them.\n&#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Ensure writes are durably stored before acknowledging to the client.&#34;</span>)</span></span></code></pre></div><p>Focus on requirements rather than implementation details. Say &ldquo;Ensure writes are durably stored before acknowledging&rdquo; instead of &ldquo;You must call fsync&rdquo;.</p><p>Avoid:</p><ul><li>Generic messages: &ldquo;Fix your code&rdquo;</li><li>Vague messages: &ldquo;This is wrong&rdquo;</li><li>Past tense: &ldquo;Your server accepted an empty key when it should reject it&rdquo;</li><li>Unnecessary adverbs: &ldquo;Your server should handle requests correctly&rdquo;</li></ul><p>Example error output:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>PUT /kv/ &#34;value&#34;
</span></span><span style=display:flex><span>  Expected response: &#34;key cannot be empty\n&#34;
</span></span><span style=display:flex><span>  Actual response: &#34;&#34;
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>  Your server should reject empty keys.
</span></span><span style=display:flex><span>  Add validation to return 400 Bad Request for empty keys.
</span></span></code></pre></div><h2 id=creating-a-challenge>Creating a Challenge<a class=anchor href=#creating-a-challenge>#</a></h2><h3 id=directory-structure>Directory Structure<a class=anchor href=#directory-structure>#</a></h3><pre tabindex=0><code>challenges/
└── kvstore/
    ├── init.go           # Challenge registration
    ├── http_api.go       # Stage 1
    ├── persistence.go    # Stage 2
    └── crash_recovery.go # Stage 3</code></pre><h3 id=stage-structure>Stage Structure<a class=anchor href=#stage-structure>#</a></h3><p>Each stage is a function returning <code>*Suite</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>kvstore</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    . <span style=color:#e6db74>&#34;github.com/st3v3nmw/lsfr/internal/attest&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>HTTPAPI</span>() <span style=color:#f92672>*</span><span style=color:#a6e22e>Suite</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>New</span>().
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 0</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Setup</span>(<span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>do</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Do</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>Start</span>(<span style=color:#e6db74>&#34;node&#34;</span>)
</span></span><span style=display:flex><span>        }).
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 1</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Test</span>(<span style=color:#e6db74>&#34;PUT Basic Operations&#34;</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>do</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Do</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>HTTP</span>(<span style=color:#e6db74>&#34;node&#34;</span>, <span style=color:#e6db74>&#34;PUT&#34;</span>, <span style=color:#e6db74>&#34;/kv/key&#34;</span>, <span style=color:#e6db74>&#34;value&#34;</span>).<span style=color:#a6e22e>T</span>().
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Status</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#ae81ff>200</span>)).
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Assert</span>(<span style=color:#e6db74>&#34;Your server should accept PUT requests.&#34;</span>)
</span></span><span style=display:flex><span>        }).
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 2</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Test</span>(<span style=color:#e6db74>&#34;GET Basic Operations&#34;</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>do</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Do</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>do</span>.<span style=color:#a6e22e>HTTP</span>(<span style=color:#e6db74>&#34;node&#34;</span>, <span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#e6db74>&#34;/kv/key&#34;</span>).<span style=color:#a6e22e>T</span>().
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Status</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#ae81ff>200</span>)).
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Body</span>(<span style=color:#a6e22e>Is</span>(<span style=color:#e6db74>&#34;value&#34;</span>)).
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Assert</span>(<span style=color:#e6db74>&#34;Your server should return stored values.&#34;</span>)
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>Import <code>attest</code> with <code>.</code> for cleaner syntax. Number tests with comments (0, 1, 2&mldr;) to visually separate tests so that they&rsquo;re not crowded.</p><h3 id=challenge-registration>Challenge Registration<a class=anchor href=#challenge-registration>#</a></h3><p>Create <code>init.go</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>kvstore</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;github.com/st3v3nmw/lsfr/internal/registry&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>init</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>challenge</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>registry</span>.<span style=color:#a6e22e>Challenge</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Name</span>: <span style=color:#e6db74>&#34;Distributed Key-Value Store&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Summary</span>: <span style=color:#e6db74>`Build a distributed key-value store from scratch.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>You&#39;ll start with a simple HTTP API and progressively add persistence,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>crash recovery, clustering, replication, and consensus.`</span>,
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>challenge</span>.<span style=color:#a6e22e>AddStage</span>(<span style=color:#e6db74>&#34;http-api&#34;</span>, <span style=color:#e6db74>&#34;Store and Retrieve Data&#34;</span>, <span style=color:#a6e22e>HTTPAPI</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>challenge</span>.<span style=color:#a6e22e>AddStage</span>(<span style=color:#e6db74>&#34;persistence&#34;</span>, <span style=color:#e6db74>&#34;Data Survives SIGTERM&#34;</span>, <span style=color:#a6e22e>Persistence</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>challenge</span>.<span style=color:#a6e22e>AddStage</span>(<span style=color:#e6db74>&#34;crash-recovery&#34;</span>, <span style=color:#e6db74>&#34;Data Survives SIGKILL&#34;</span>, <span style=color:#a6e22e>CrashRecovery</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>challenge</span>.<span style=color:#a6e22e>AddStage</span>(<span style=color:#e6db74>&#34;leader-election&#34;</span>, <span style=color:#e6db74>&#34;Cluster Elects and Maintains Leader&#34;</span>, <span style=color:#a6e22e>LeaderElection</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>registry</span>.<span style=color:#a6e22e>RegisterChallenge</span>(<span style=color:#e6db74>&#34;kv-store&#34;</span>, <span style=color:#a6e22e>challenge</span>)
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=auto-discovery>Auto-Discovery<a class=anchor href=#auto-discovery>#</a></h3><p>Import your challenge in <code>challenges/challenges.go</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>challenges</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>_</span> <span style=color:#e6db74>&#34;github.com/st3v3nmw/lsfr/challenges/kvstore&#34;</span>
</span></span><span style=display:flex><span>)</span></span></code></pre></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div></div><div></div></div><div class="flex flex-wrap justify-between"><span><a href=/guides/ci-cd/ class="flex align-center"><img src=/icons/backward.svg class=book-icon alt=Backward>
<span>CI/CD</span>
</a></span><span><a href=/reference/writing-style/ class="flex align-center"><span>Writing Style</span>
<img src=/icons/forward.svg class=book-icon alt=Forward></a></span></div><div class="book-copyright flex justify-center"><small>lsfr.io - <a href=https://github.com/st3v3nmw/lsfr.io/blob/main/LICENSE>© CC BY 4.0</a></small></div><script>(function(){document.querySelectorAll("pre:has(code)").forEach(e=>{e.addEventListener("click",e.focus),e.addEventListener("copy",function(t){if(t.preventDefault(),navigator.clipboard){const t=window.getSelection().toString()||e.textContent;navigator.clipboard.writeText(t)}})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#quick-start>Quick Start</a></li><li><a href=#http-assertions>HTTP Assertions</a></li><li><a href=#cli-assertions>CLI Assertions</a></li><li><a href=#checkers>Checkers</a><ul><li><a href=#isvalue><code>Is(value)</code></a></li><li><a href=#isnullt><code>IsNull[T]()</code></a></li><li><a href=#containssubstring><code>Contains(substring)</code></a></li><li><a href=#matchespattern><code>Matches(pattern)</code></a></li><li><a href=#oneofvalues><code>OneOf(values...)</code></a></li><li><a href=#notchecker><code>Not(checker)</code></a></li><li><a href=#multiple-checkers>Multiple Checkers</a></li></ul></li><li><a href=#timing>Timing</a><ul><li><a href=#eventually><code>Eventually()</code></a></li><li><a href=#consistently><code>Consistently()</code></a></li><li><a href=#default-immediate>Default (Immediate)</a></li></ul></li><li><a href=#service-management>Service Management</a><ul><li><a href=#startname-args><code>Start(name, args...)</code></a></li><li><a href=#stopname><code>Stop(name)</code></a></li><li><a href=#killname><code>Kill(name)</code></a></li><li><a href=#restartname-sig><code>Restart(name, sig...)</code></a></li></ul></li><li><a href=#concurrency>Concurrency</a><ul><li><a href=#concurrentlyfuncs><code>Concurrently(funcs...)</code></a></li></ul></li><li><a href=#writing-good-assertions>Writing Good Assertions</a></li><li><a href=#creating-a-challenge>Creating a Challenge</a><ul><li><a href=#directory-structure>Directory Structure</a></li><li><a href=#stage-structure>Stage Structure</a></li><li><a href=#challenge-registration>Challenge Registration</a></li><li><a href=#auto-discovery>Auto-Discovery</a></li></ul></li></ul></nav></div></aside></main></body></html>